C51 COMPILER V9.56.0.0   LCM                                                               11/10/2017 09:15:02 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCM
OBJECT MODULE PLACED IN LCM.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LCM.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(C:\Keil_v5\C51\INC\SiLABS\sha
                    -red\si8051Base) DEBUG PRINT(.\Listings\LCM.lst) TABS(2)

line level    source

   1          #include <stdint.h> //è·¯å¾‘ï¼šC:\Keil_v5\C51\INC\SiLABS\shared\si8051Base
   2          #include <stdio.h>
   3          #include <stdlib.h> //functionï¼šå‹•æ…‹è¨˜æ†¶é«”é…ç½®
   4          #include <string.h> //functionï¼šstrlen
   5          
   6          
   7          #include "CPLD.h"
   8          #include "LCM.h"
   9          #include "other.h"
  10          #include "delay.h"
  11          
  12          
  13          
  14          /** LCM_Basic_setting èªªæ˜ï¼šR/W(SID) æ§åˆ¶å‡½å¼
  15            *
  16            * Selectï¼šå‘½ä»¤LCMåŸ·è¡Œ-->æ§åˆ¶æŒ‡ä»¤ã€é¡¯ç¤ºæŒ‡ä»¤
  17            * Addressï¼š8ä½å…ƒæ•¸æ“š(é«˜4ä½èˆ‡ä½4ä½)ï¼ŒæŒ‡ä»¤è¼¸å…¥(1Bytes) 
  18            *  #Address å¯ç›´æ¥ä¸Ÿ"å­—ä¸²"ã€'å­—å…ƒ'(è‹±æ–‡&ç¬¦è™Ÿ)ï¼ŒLCMæœƒè‡ªè¡Œåˆ¤æ–·
  19            *
  20          ***/
  21          void LCM_Basic_Setting(signed char  Select, signed char  Address) {
  22   1      
  23   1            signed char  decide_8bits = 0; //è¼¸å…¥è¨Šè™Ÿæ˜¯å¦ç‚º 8bits
  24   1        
  25   1            unsigned char LCM_command; //LCM_Basic_Setting å°ˆç”¨æš«å­˜è®Šæ•¸(å„²å­˜SIDæ§åˆ¶ä½å€)
  26   1            unsigned char LCM_address; //LCM_Basic_Setting å°ˆç”¨æš«å­˜è®Šæ•¸(å„²å­˜SIDé«˜4,ä½4ä½å€)
  27   1        
  28   1            /**===== R/Wã€E è…³ä½æ§åˆ¶ =====
  29   1              * R/W = SID :   é…åˆSCLKçš„è¼¸å…¥è¨Šè™Ÿï¼Œä¸€æ¬¡è¼¸å…¥ä¸€å€‹ä½å…ƒè¨Šè™Ÿ
  30   1              *   cpld_out(LCM_SID,OR);   --> SID = '1' 
  31   1              *   cpld_out(LCM_SID,AND);  --> SID = '0'
  32   1              *
  33   1              * E = SCLK  ï¼š è„ˆæ³¢è¨Šè™Ÿï¼Œé…åˆR/Wçš„ä½å…ƒè³‡æ–™è¼¸å…¥
  34   1              *   cpld_out(LCM_SCLK,OR);   --> E = '1'  
  35   1              *   cpld_out(LCM_SCLK,AND);  --> E = '0'
  36   1            **/
  37   1        
  38   1            cpld_out(LCM_SID,AND);  //SID->'0'
  39   1              //cpld_action(); //ç«‹åˆ»åŸ·è¡Œ(ç«‹å³å°‡æš«å­˜æ–¼è®Šæ•¸çš„å€¼ï¼Œè¼¸å‡ºåˆ°è©²è…³ä½å€)
  40   1        
  41   1            // LCM_1ï¼šON
  42   1            cpld_out(LCM_CS,OR); //CS = '1'
  43   1              //cpld_action();
  44   1            
  45   1            /*==== é–‹å§‹è¼¸å…¥è¨Šè™Ÿé€²å…¥LCM ====*/
  46   1            
  47   1            switch( Select ) {
  48   2              case LCM_Select_Control:  LCM_command = 0xF8; break;  //LCMç‚º[æ§åˆ¶ç‹€æ…‹]
  49   2              case LCM_Select_Dispaly:  LCM_command = 0xFA; break;  //LCMç‚º[é¡¯ç¤ºç‹€æ…‹]  
  50   2              
  51   2              default : LCM_command = Select; break;
  52   2            }
  53   1            
  54   1            /*----ç¬¬1å­—ç¯€ï¼š LCMä¸²å£æ§åˆ¶æ ¼å¼ (8 bits)----*/
C51 COMPILER V9.56.0.0   LCM                                                               11/10/2017 09:15:02 PAGE 2   

  55   1            for(decide_8bits = 7; decide_8bits >= 0; decide_8bits--) {
  56   2            
  57   2                if( (LCM_command & (0x01 << decide_8bits) ) >> decide_8bits == 1 )  cpld_out(LCM_SID,OR);  //SID = '1'
  58   2                  else cpld_out(LCM_SID,AND); //SID = '0'
  59   2                        //cpld_action();
  60   2              
  61   2                  //æ‰“E(SCLK)è„ˆæ³¢è¨Šè™Ÿ
  62   2                    cpld_out(LCM_SCLK,OR);  //SCLK = '1'
  63   2                      //cpld_action();
  64   2                    cpld_out(LCM_SCLK,AND); //SCLK = '0'
  65   2                      //cpld_action();
  66   2            }
  67   1            
  68   1            /*----ç¬¬2å­—ç¯€ï¼š 8ä½æ•¸æ“šçš„ é«˜4ä½å…ƒ (DDDD,0000)----*/
  69   1            LCM_address = (0xF0 & Address);
  70   1            for(decide_8bits = 7; decide_8bits >= 0; decide_8bits--) {
  71   2                
  72   2                if( (LCM_address & (0x01 << decide_8bits)) >> decide_8bits == 1 ) cpld_out(LCM_SID,OR); //SID = '1'
  73   2                  else cpld_out(LCM_SID,AND); //SID = '0'
  74   2                        //cpld_action();
  75   2              
  76   2                  //æ‰“E(SCLK)è„ˆæ³¢è¨Šè™Ÿ
  77   2                    cpld_out(LCM_SCLK,OR);  //SCLK = '1'
  78   2                      //cpld_action();
  79   2                    cpld_out(LCM_SCLK,AND); //SCLK = '0'
  80   2                      //cpld_action();
  81   2            }
  82   1            
  83   1            /*----ç¬¬3å­—ç¯€ï¼š 8ä½æ•¸æ“šçš„ ä½4ä½å…ƒ (0000,DDDD)----*/
  84   1            LCM_address = (0x0F & Address) << 4;
  85   1            for(decide_8bits = 7; decide_8bits >= 0; decide_8bits--) {
  86   2                
  87   2                if( (LCM_address & (0x01 << decide_8bits)) >> decide_8bits == 1 ) cpld_out(LCM_SID,OR); //SID = '1'
  88   2                  else cpld_out(LCM_SID,AND); //SID = '0'
  89   2                        //cpld_action();
  90   2              
  91   2                  //æ‰“E(SCLK)è„ˆæ³¢è¨Šè™Ÿ
  92   2                    cpld_out(LCM_SCLK,OR);  //SCLK = '1'
  93   2                      //cpld_action();
  94   2                    cpld_out(LCM_SCLK,AND); //SCLK = '0'
  95   2                      //cpld_action();
  96   2            }
  97   1            
  98   1            
  99   1            // LCM_1ï¼šOFF
 100   1            cpld_out(LCM_CS,AND); //CS = '0'
 101   1              //cpld_action();
 102   1        
 103   1      }
 104          
 105          /** 
 106            *   LCM åŠŸèƒ½é¸æ“‡å‡½å¼
 107          **/
 108          
 109          //  LCM_Display_Function èªªæ˜ï¼šLCM_é¡¯ç¤ºæ•ˆæœé¸æ“‡
 110          //-------æ–‡å­—é¡¯ç¤º------
 111          //  1.é¡¯ç¤ºåŠŸèƒ½ ON ä¸€æ¬¡å°±å¯ä»¥æŒçºŒä½¿ç”¨äº†ï¼Œç­‰åˆ°çµæŸåœ¨OFFã€‚
 112          //-------æ–‡å­—å·¦å³ç§»å‹•------
 113          //  1. æ•´é«”å·¦ã€å³ç§»éœ€å…ˆä½¿ç”¨ï¼šLCM_Print_Char_Function å†ä½¿ç”¨ LCM_Display_Function å·¦å³ç§»åŠŸ
             -èƒ½ã€‚
 114          //  2. æ•´é«”å·¦ç§»ã€å³ç§»ï¼šä¸€æ¬¡æœƒç§»å‹•æ•´å€‹å­—ä¸²ï¼Œå¦‚æœè¦åšåˆ°smoothè¦å°‡å­—ä¸²æ‹†æˆå­—å…ƒä
             -¾†ä½ç§»???
C51 COMPILER V9.56.0.0   LCM                                                               11/10/2017 09:15:02 PAGE 3   

 115          //
 116          //
 117          void LCM_Display_Function(unsigned char  FUN_) {
 118   1      
 119   1          switch(FUN_) {
 120   2            case 0 :  LCM_Basic_Setting (LCM_Select_Control, 0x08); break;  //é¡¯ç¤ºåŠŸèƒ½OFF
 121   2            case 1 :  LCM_Basic_Setting (LCM_Select_Control, 0x0C); break;  //é¡¯ç¤ºåŠŸèƒ½ON
 122   2            case 2 :  LCM_Basic_Setting (LCM_Select_Control, 0x0E); break;  //é¡¯ç¤º+é–‹å•Ÿæ¸¸æ¨™ (æ¸¸æ¨™ '___')
 123   2            case 3 :  LCM_Basic_Setting (LCM_Select_Control, 0x0D); break;  //é¡¯ç¤º+é–‹å•Ÿæ¸¸æ¨™ä½ç½®åç™½
 124   2            case 4 :  LCM_Basic_Setting (LCM_Select_Control, 0x0F); break;  //é–‹å•Ÿé¡¯ç¤º+æ¸¸æ¨™+æ¸¸æ¨™åç™½
 125   2          }
 126   1      }
 127          
 128          
 129          
 130          //  LCM_RowCH_Function èªªæ˜ï¼šLCM_æ®µè½åˆ‡æ› (èªªæ˜æ›¸P9.ç‚ºæ¼¢å­—é¡¯ç¤ºåº§æ¨™)
 131          //=== 
 132          //=== çµ•å°ä½ç½®ï¼šLCM_Basic_Setting( LCM_Select_Control , 1 AC6~AC0) 
 133          //=== AC6~AC0 ç‚ºæ¯ä¸€è¡Œçš„æŒ‡å®šä½ç½®
 134          //===
 135          void LCM_Row_Function(unsigned char  ROW_) {
 136   1      
 137   1          switch(ROW_) {
 138   2            case 1 :  LCM_Basic_Setting (LCM_Select_Control, 0x80); break;  //Row 1
 139   2            case 2 :  LCM_Basic_Setting (LCM_Select_Control, 0x90); break;  //Row 2
 140   2            case 3 :  LCM_Basic_Setting (LCM_Select_Control, 0x88); break;  //Row 3
 141   2            case 4 :  LCM_Basic_Setting (LCM_Select_Control, 0x98); break;  //Row 4
 142   2          }
 143   1      }
 144          
 145          
 146          
 147          
 148          //===LCM_Print_Char_Function èªªæ˜ï¼šé¡¯ç¤ºå­—ä¸²ç¬¦è™Ÿï¼Œä¸¦å›å‚³è¼¸å…¥å­—ä¸²é•·åº¦
 149          //=== 
 150          //=== ROW_ : é¡¯ç¤ºæ®µè½é¸æ“‡
 151          //=== PRINT_[] : array è¼¸å…¥é¡¯ç¤ºè³‡æ–™ (LCMå¯é¡¯ç¤ºï¼šä¸­å­—--> 4è¡Œ*8å€‹ï¼›  è‹±æ–‡--> 4è¡Œx16å€‹ ) 
 152          //===   è¼¸å…¥å…§å®¹è¨»è¨˜ï¼š
 153          //===         1.  TABæœƒé¡¯ç¤º "o"
 154          
 155          int LCM_Print_Char_Function(unsigned int ROW_, unsigned char  PRINT_[]) { 
 156   1        
 157   1          int  PRINT_length = 0,  count_length = 0; //ç´€éŒ„é¡¯ç¤ºå…§å®¹é•·åº¦ã€è¨ˆç®—æ–‡å­—é•·åº¦
 158   1        
 159   1          PRINT_length  =  strlen(PRINT_); //åˆ¤æ–· PRINT_ è³‡æ–™é•·åº¦
 160   1        
 161   1          LCM_Row_Function(ROW_); //é¸æ“‡é¡¯ç¤ºæ–¼ç¬¬å¹¾è¡Œ
 162   1        
 163   1        
 164   1          //é€å…¥æ–‡å­—ï¼Œä¸¦åˆ¤æ–·æ˜¯å¦éœ€è¦'æ›è¡Œ'
 165   1          while (count_length < PRINT_length) {
 166   2          
 167   2              LCM_Basic_Setting (LCM_Select_Dispaly, PRINT_[ count_length++ ]); //å°‡æ–‡å­—å€‹åˆ¥é€å…¥LCM
 168   2              
 169   2                //åˆ¤æ–·é€™è¡Œæ–‡å­—æ˜¯å¦æ»¿16ä½å…ƒ
 170   2                if ( count_length %16 == 0 ) {
 171   3                    //å¦‚æœæ»¿äº†å‰‡ ROW_ +1(è·³ä¸‹ä¸€è¡Œ)ï¼Œç­‰åˆ°åœ¨ä¸€æ¬¡æ»¿å†+1ï¼Œç›´åˆ°ç¬¬4è¡Œå¾Œï¼Œè·³å›ç¬¬ä¸€
             -è¡Œ
 172   3                    if ( ++ROW_ > 4)  ROW_ = 1; 
 173   3                        LCM_Row_Function(ROW_);
 174   3                }
 175   2          }
C51 COMPILER V9.56.0.0   LCM                                                               11/10/2017 09:15:02 PAGE 4   

 176   1      
 177   1          //é›–ç„¶LCMå­—ä¸²è¼¸å…¥æ™‚ï¼Œæœªæ»¿16ä½å…ƒLCMæœƒè‡ªå‹•ç”¨ç©ºæ ¼è£œæ»¿16ä½å…ƒï¼Œ
 178   1          //ä½†æ˜¯ç‚ºäº† LCM_Remove_Display æ¸…é™¤å–®è¡Œå­—ä¸²æ™‚ä½¿ç”¨ï¼Œä¸éœ€å–®è¡Œæ¸…é™¤æ™‚ï¼Œæ­¤whileè¿´åœˆå
             -¯ä¸ä½¿ç”¨
 179   1          //ç•¶count_lengthé™¤æ–¼16ä¹‹é¤˜æ•¸ä¸ç­‰æ–¼0æ™‚
 180   1          //(æœ€å¾Œä½¿ç”¨16å€‹ç©ºæ ¼ä»£æ›¿äº†æ­¤å‡½å¼)
 181   1          
 182   1          /*
 183   1          while (count_length %16 != 0) {
 184   1            
 185   1            LCM_Basic_Setting (LCM_Select_Dispaly,  ' ');  //LCM_Basic_Setting å¯ç›´æ¥åˆ¤æ–·ç¬¦è™Ÿï¼Œ'ç©ºæ ¼'è¡¨ç
             -¤ºè¼¸å…¥ç©ºæ ¼ç¬¦è™Ÿã€‚
 186   1            count_length++; //ç›´åˆ°æ­¤è¡Œå¡«æ»¿16ä½å…ƒç‚ºæ­¢
 187   1          }
 188   1          */
 189   1          
 190   1          return  PRINT_length; //å›å‚³è¼¸å…¥å­—ä¸²é•·åº¦
 191   1      }
 192          
 193          
 194          //===LCM_Print_Number_Function èªªæ˜ï¼šé¡¯ç¤ºæ•¸å­— (è¼¸å…¥Numberç„¡æ³•ä½¿ç”¨ï¼šbitå‹æ…‹)
 195          void LCM_Print_Number_Function(unsigned int ROW_, float Number) {
 196   1      
 197   1          char xdata *Number_length;  //å‹•æ…‹è¨˜æ†¶é«”æŒ‡æ¨™
 198   1          int  xdata  arrLen = 30;    //å‹•æ…‹è¨˜æ†¶é«”ï¼šé…ç½®ç©ºé–“å¤§å°
 199   1          
 200   1        /** å‹•æ…‹è¨˜æ†¶é«”ä¸»ç¨‹å¼ **/
 201   1          init_mempool( &Number_length, arrLen *sizeof(char) ); //åˆå§‹åŒ–è¨˜æ†¶é«”ä½ç½®
*** WARNING C259 IN LINE 201 OF LCM.c: 'parameter': pointer: different mspace
 202   1        
 203   1          Number_length = malloc ( arrLen *sizeof(char) );      //å–å¾—è¨˜æ†¶é«”ç©ºé–“
 204   1          
 205   1          other_loat_to_string(Number, Number_length);          //ä»»æ„æ•¸å­—è½‰å­—ä¸²
 206   1      
 207   1          LCM_Print_Char_Function( ROW_, Number_length);        //LCMè¼¸å‡º
 208   1        
 209   1        /** é‡‹æ”¾è¨˜æ†¶é«”ç©ºé–“ **/
 210   1          free(Number_length);
 211   1      
 212   1      }
 213          
 214          //===LCM_Remove_Display æ¸…é™¤é¡¯ç¤ºå…§å®¹
 215          //=== 
 216          void LCM_Remove_Display(unsigned char ROW_) {
 217   1          
 218   1          switch(ROW_) {
 219   2              case 0 :  LCM_Basic_Setting(LCM_Select_Control, 0x01);   break;   //æ¸…é™¤å…¨éƒ¨å…§å®¹...
 220   2              case 1 :  LCM_Print_Char_Function(1, "                ");  break; //åªæ¸…é™¤ç¬¬ä¸€è¡Œ
 221   2              case 2 :  LCM_Print_Char_Function(2, "                ");  break; //åªæ¸…é™¤ç¬¬äºŒè¡Œ
 222   2              case 3 :  LCM_Print_Char_Function(3, "                ");  break; //åªæ¸…é™¤ç¬¬ä¸‰è¡Œ
 223   2              case 4 :  LCM_Print_Char_Function(4, "                ");  break; //åªæ¸…é™¤ç¬¬å››è¡Œ
 224   2          }
 225   1      }
 226          
 227          
 228          
 229          
 230          //===LCM_Effect_Function  LCM æ•ˆæœæŒ‡ä»¤
 231          //
 232          void LCM_Effect_Function( unsigned char Eff_ )  {
 233   1      
 234   1          //LCM_Basic_Setting(LCM_Select_Control, 0x30); //LCMåŠŸèƒ½è¨­å®šï¼šé–‹å•Ÿ8bitæ§åˆ¶ä»‹é¢ & RE=0 åªä½¿ç
C51 COMPILER V9.56.0.0   LCM                                                               11/10/2017 09:15:02 PAGE 5   

             -”¨åŸºæœ¬æŒ‡ä»¤ (RE=1 ä½¿ç”¨æ“´å……æŒ‡ä»¤)
 235   1          //LCM_Basic_Setting(LCM_Select_Control, 0x06); //æ¸¸æ¨™å³ç§»
 236   1        
 237   1            switch(Eff_) {
 238   2              case MOV_Right: LCM_Basic_Setting (LCM_Select_Control, 0x1C); break;  // å­—ä¸²å‘å³ç§»å‹•
 239   2              case MOV_Left : LCM_Basic_Setting (LCM_Select_Control, 0x18); break;  // å­—ä¸²å‘å·¦ç§»å‹•
 240   2              
 241   2              case 3 :  // å­—ä¸²é–‹é ­åç™½(åç™½ç¯„åœï¼š2 bits)
 242   2                        LCM_Basic_Setting (LCM_Select_Control, 0x80); //åç™½ä½ç½®( åˆå§‹è¨­å®š 80H ä½ç½® )
 243   2                        LCM_Basic_Setting (LCM_Select_Control, 0x0D); //é–‹å•Ÿåç™½
 244   2                                                                            break;
 245   2              
 246   2              //ing....
 247   2          }
 248   1      
 249   1          
 250   1          
 251   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    681    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      22
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
